<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tirzepatida Control | Gestão de Estoque</title>
    <meta
      name="description"
      content="Sistema de controle e previsão de estoque de Tirzepatida"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>

    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
      <div class="login-container">
        <div class="login-logo">
          <div class="logo-icon">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"
              />
            </svg>
          </div>
          <h1>Tirzepatida Control</h1>
          <p>Sistema de Gestão de Estoque</p>
        </div>
        <form id="login-form" class="login-form">
          <div class="input-group">
            <label for="login-email">Email</label>
            <input
              type="email"
              id="login-email"
              placeholder="seu@email.com"
              required
            />
          </div>
          <div class="input-group">
            <label for="login-password">Senha</label>
            <input
              type="password"
              id="login-password"
              placeholder="••••••••"
              required
              minlength="6"
            />
          </div>
          <div id="register-fields" class="hidden">
            <div class="input-group">
              <label for="register-name">Nome Completo</label>
              <input
                type="text"
                id="register-name"
                placeholder="Dr. Paulo Guimarães Jr"
              />
            </div>
          </div>
          <button type="submit" class="btn btn-primary btn-full">
            <span id="auth-btn-text">Entrar</span>
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="m9 18 6-6-6-6" />
            </svg>
          </button>
        </form>
        <p class="login-footer">
          <span id="toggle-auth-text">Primeiro acesso?</span>
          <a href="#" id="toggle-auth-link" onclick="toggleAuthMode(event)">Criar conta</a>
        </p>
      </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app hidden">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <div class="logo-small">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"
              />
            </svg>
          </div>
          <div class="header-title">
            <h1>Tirzepatida Control</h1>
            <span class="header-subtitle">Dashboard de Estoque</span>
          </div>
        </div>
        <div class="header-right">
          <div class="user-info">
            <span id="user-role-badge" class="role-badge admin">Admin</span>
            <span id="user-email">usuario@email.com</span>
            <button id="admin-btn" class="btn btn-ghost admin-only" onclick="openModal('admin-modal')" title="Administração">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
            <button id="logout-btn" class="btn btn-ghost">Sair</button>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Alert Banner -->
        <div id="alert-banner" class="alert-banner hidden">
          <div class="alert-icon">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"
              />
              <path d="M12 9v4" />
              <path d="M12 17h.01" />
            </svg>
          </div>
          <div class="alert-content">
            <strong id="alert-title">Atenção!</strong>
            <span id="alert-message">Estoque baixo</span>
          </div>
          <button class="alert-close" onclick="closeAlert()">×</button>
        </div>

        <!-- Stock Status Cards -->
        <section class="stock-overview">
          <div class="card stock-card main-stock">
            <div class="stock-gauge">
              <svg viewBox="0 0 120 120" class="gauge-svg">
                <circle cx="60" cy="60" r="54" class="gauge-bg" />
                <circle
                  cx="60"
                  cy="60"
                  r="54"
                  class="gauge-fill"
                  id="stock-gauge-fill"
                />
              </svg>
              <div class="gauge-center">
                <span class="gauge-value" id="stock-percentage">0%</span>
                <span class="gauge-label">Estoque</span>
              </div>
            </div>
            <div class="stock-info">
              <h3>Estoque Atual</h3>
              <div class="stock-value">
                <span id="current-stock">0</span>
                <span class="unit">mg</span>
              </div>
              <div class="stock-meta">
                <span class="meta-item">
                  <span class="meta-label">Capacidade:</span>
                  <span id="max-stock">500</span> mg
                </span>
              </div>
            </div>
          </div>

          <div class="card stat-card">
            <div class="stat-icon blue">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                <circle cx="9" cy="7" r="4" />
                <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
              </svg>
            </div>
            <div class="stat-content">
              <span class="stat-value" id="active-patients">0</span>
              <span class="stat-label">Pacientes Ativos</span>
            </div>
          </div>

          <div class="card stat-card">
            <div class="stat-icon green">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2" />
                <line x1="16" x2="16" y1="2" y2="6" />
                <line x1="8" x2="8" y1="2" y2="6" />
                <line x1="3" x2="21" y1="10" y2="10" />
              </svg>
            </div>
            <div class="stat-content">
              <span class="stat-value" id="days-remaining">--</span>
              <span class="stat-label">Dias de Estoque</span>
            </div>
          </div>

          <div class="card stat-card">
            <div class="stat-icon purple">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
              </svg>
            </div>
            <div class="stat-content">
              <span class="stat-value" id="avg-consumption">0</span>
              <span class="stat-label">mg/dia (média)</span>
            </div>
          </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
          <div class="card chart-card large">
            <div class="card-header">
              <h3>Projeção de Estoque</h3>
              <div class="chart-legend">
                <span class="legend-item"
                  ><span class="legend-dot blue"></span>Histórico</span
                >
                <span class="legend-item"
                  ><span class="legend-dot orange"></span>Projeção</span
                >
                <span class="legend-item"
                  ><span class="legend-dot red"></span>Nível Crítico</span
                >
              </div>
            </div>
            <div class="chart-container">
              <canvas id="stock-projection-chart"></canvas>
            </div>
          </div>

          <div class="card chart-card">
            <div class="card-header">
              <h3>Consumo por Período</h3>
              <select id="consumption-period" class="select-small">
                <option value="7">Últimos 7 dias</option>
                <option value="30" selected>Últimos 30 dias</option>
                <option value="90">Últimos 90 dias</option>
              </select>
            </div>
            <div class="chart-container">
              <canvas id="consumption-chart"></canvas>
            </div>
          </div>
        </section>

        <!-- Actions & Data Section -->
        <section class="actions-section">
          <!-- Quick Actions -->
          <div class="card actions-card">
            <h3>Ações Rápidas</h3>
            <div class="action-buttons">
              <button
                class="btn btn-primary"
                onclick="openModal('application-modal')"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"
                  />
                </svg>
                Registrar Aplicação
              </button>
              <button
                class="btn btn-secondary"
                onclick="openModal('restock-modal')"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
                  />
                  <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                  <line x1="12" y1="22.08" x2="12" y2="12" />
                </svg>
                Entrada de Estoque
              </button>
              <button
                class="btn btn-outline"
                onclick="openModal('import-modal')"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                  <polyline points="17 8 12 3 7 8" />
                  <line x1="12" y1="3" x2="12" y2="15" />
                </svg>
                Importar CSV
              </button>
            </div>
          </div>

          <!-- Suppliers Recommendation -->
          <div class="card suppliers-card">
            <h3>Recomendação de Pedido</h3>
            <div id="supplier-recommendations">
              <div class="supplier-item">
                <div class="supplier-info">
                  <span class="supplier-name">Carregando...</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Products & Lots Section -->
        <section class="products-section">
          <div class="card table-card">
            <div class="card-header">
              <h3>Produtos Cadastrados</h3>
              <div class="table-actions">
                <button class="btn btn-primary" onclick="openModal('product-modal')">
                  + Novo Produto
                </button>
              </div>
            </div>
            <div class="table-container">
              <table id="products-table">
                <thead>
                  <tr>
                    <th>Produto</th>
                    <th>Marca</th>
                    <th>Concentração</th>
                    <th>Fabricante</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="products-tbody">
                  <!-- Dynamic content -->
                </tbody>
              </table>
            </div>
          </div>

          <div class="card table-card">
            <div class="card-header">
              <h3>Lotes em Estoque</h3>
              <div class="table-actions">
                <button class="btn btn-primary" onclick="openModal('lot-modal')">
                  + Novo Lote
                </button>
              </div>
            </div>
            <div class="table-container">
              <table id="lots-table">
                <thead>
                  <tr>
                    <th>Lote</th>
                    <th>Produto</th>
                    <th>Validade</th>
                    <th>Qtd Disp.</th>
                    <th>Fornecedor</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="lots-tbody">
                  <!-- Dynamic content -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Recent Applications Table -->
        <section class="table-section">
          <div class="card table-card">
            <div class="card-header">
              <h3>Aplicações Recentes</h3>
              <div class="table-actions">
                <input
                  type="text"
                  id="search-applications"
                  placeholder="Buscar paciente..."
                  class="search-input"
                />
                <button class="btn btn-ghost" onclick="exportApplications()">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                  </svg>
                  Exportar
                </button>
              </div>
            </div>
            <div class="table-container">
              <table id="applications-table">
                <thead>
                  <tr>
                    <th>Data</th>
                    <th>Paciente</th>
                    <th>Dose</th>
                    <th>Próxima</th>
                    <th>Aplicador</th>
                  </tr>
                </thead>
                <tbody id="applications-tbody">
                  <!-- Dynamic content -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Patients Section -->
        <section class="patients-section">
          <div class="card table-card">
            <div class="card-header">
              <h3>Pacientes Ativos</h3>
              <div class="table-actions">
                <input
                  type="text"
                  id="search-patients"
                  placeholder="Buscar paciente..."
                  class="search-input"
                />
                <button
                  class="btn btn-ghost raw-editor-btn"
                  onclick="openModal('raw-editor-modal')"
                >
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M16 18l6-6-6-6" />
                    <path d="M8 6l-6 6 6 6" />
                  </svg>
                  Raw Editor
                </button>
                <button
                  class="btn btn-outline"
                  onclick="openModal('patient-modal')"
                >
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <line x1="19" y1="8" x2="19" y2="14" />
                    <line x1="22" y1="11" x2="16" y2="11" />
                  </svg>
                  Adicionar
                </button>
              </div>
            </div>
            <div class="table-container">
              <table id="patients-table">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>Dose Atual</th>
                    <th>Intervalo</th>
                    <th>Próxima Aplicação</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="patients-tbody">
                  <!-- Dynamic content -->
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- MODALS -->

    <!-- Application Modal -->
    <div id="application-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Registrar Aplicação</h2>
          <button class="modal-close" onclick="closeModal('application-modal')">
            ×
          </button>
        </div>
        <form id="application-form">
          <div class="form-grid">
            <div class="input-group">
              <label for="app-patient">Paciente</label>
              <select id="app-patient" required>
                <option value="">Selecione...</option>
              </select>
            </div>
            <div class="input-group">
              <label for="app-dose">Dose (mg)</label>
              <select id="app-dose" required>
                <option value="1.0">1,0 mg</option>
                <option value="1.5">1,5 mg</option>
                <option value="2.0">2,0 mg</option>
                <option value="2.5" selected>2,5 mg</option>
                <option value="3.5">3,5 mg</option>
                <option value="5.0">5,0 mg</option>
                <option value="7.5">7,5 mg</option>
                <option value="10.0">10,0 mg</option>
              </select>
            </div>
            <div class="input-group">
              <label for="app-date">Data</label>
              <input type="datetime-local" id="app-date" required />
            </div>
            <div class="input-group">
              <label for="app-interval">Próxima em (dias)</label>
              <select id="app-interval" required>
                <option value="7" selected>7 dias</option>
                <option value="10">10 dias</option>
                <option value="14">14 dias</option>
              </select>
            </div>
          </div>
          <div class="input-group">
            <label for="app-notes">Observações</label>
            <textarea
              id="app-notes"
              rows="2"
              placeholder="Opcional..."
            ></textarea>
          </div>
          <div class="modal-actions">
            <button
              type="button"
              class="btn btn-ghost"
              onclick="closeModal('application-modal')"
            >
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">Registrar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Restock Modal -->
    <div id="restock-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Entrada de Estoque</h2>
          <button class="modal-close" onclick="closeModal('restock-modal')">
            ×
          </button>
        </div>
        <form id="restock-form">
          <div class="form-grid">
            <div class="input-group">
              <label for="restock-amount">Quantidade (mg)</label>
              <input
                type="number"
                id="restock-amount"
                step="0.1"
                min="0"
                required
              />
            </div>
            <div class="input-group">
              <label for="restock-supplier">Fornecedor</label>
              <select id="restock-supplier">
                <option value="">Selecione...</option>
              </select>
            </div>
            <div class="input-group">
              <label for="restock-date">Data de Entrada</label>
              <input type="date" id="restock-date" required />
            </div>
            <div class="input-group">
              <label for="restock-price">Preço Total (R$)</label>
              <input type="number" id="restock-price" step="0.01" min="0" />
            </div>
          </div>
          <div class="input-group">
            <label for="restock-notes">Observações</label>
            <textarea
              id="restock-notes"
              rows="2"
              placeholder="Lote, validade, etc..."
            ></textarea>
          </div>
          <div class="modal-actions">
            <button
              type="button"
              class="btn btn-ghost"
              onclick="closeModal('restock-modal')"
            >
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              Registrar Entrada
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Import CSV Modal -->
    <div id="import-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Importar Pacientes (CSV)</h2>
          <button class="modal-close" onclick="closeModal('import-modal')">
            ×
          </button>
        </div>
        <div class="import-instructions">
          <p>O arquivo CSV deve conter as seguintes colunas:</p>
          <code>nome,dose_mg,intervalo_dias,telefone,email</code>
          <p class="hint">
            Exemplo: "João Silva,2.5,7,11999999999,joao@email.com"
          </p>
        </div>
        <form id="import-form">
          <div class="input-group">
            <label for="csv-file">Arquivo CSV</label>
            <input type="file" id="csv-file" accept=".csv" required />
          </div>
          <div class="modal-actions">
            <button
              type="button"
              class="btn btn-ghost"
              onclick="closeModal('import-modal')"
            >
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">Importar</button>
          </div>
        </form>
        <div id="import-preview" class="import-preview hidden">
          <h4>Pré-visualização:</h4>
          <div id="preview-content"></div>
        </div>
      </div>
    </div>

    <!-- Patient Modal -->
    <div id="patient-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Adicionar Paciente</h2>
          <button class="modal-close" onclick="closeModal('patient-modal')">
            ×
          </button>
        </div>
        <form id="patient-form">
          <div class="form-grid">
            <div class="input-group full">
              <label for="patient-name">Nome Completo</label>
              <input type="text" id="patient-name" required />
            </div>
            <div class="input-group">
              <label for="patient-dose">Dose Inicial (mg)</label>
              <select id="patient-dose" required>
                <option value="1.0">1,0 mg</option>
                <option value="1.5">1,5 mg</option>
                <option value="2.0">2,0 mg</option>
                <option value="2.5" selected>2,5 mg</option>
                <option value="3.5">3,5 mg</option>
                <option value="5.0">5,0 mg</option>
                <option value="7.5">7,5 mg</option>
                <option value="10.0">10,0 mg</option>
              </select>
            </div>
            <div class="input-group">
              <label for="patient-interval">Intervalo (dias)</label>
              <select id="patient-interval" required>
                <option value="7" selected>7 dias</option>
                <option value="10">10 dias</option>
                <option value="14">14 dias</option>
              </select>
            </div>
            <div class="input-group">
              <label for="patient-phone">Telefone</label>
              <input
                type="tel"
                id="patient-phone"
                placeholder="(11) 99999-9999"
              />
            </div>
            <div class="input-group">
              <label for="patient-email">Email</label>
              <input
                type="email"
                id="patient-email"
                placeholder="email@exemplo.com"
              />
            </div>
          </div>
          <div class="modal-actions">
            <button
              type="button"
              class="btn btn-ghost"
              onclick="closeModal('patient-modal')"
            >
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">Salvar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Supplier Modal -->
    <div id="supplier-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Gerenciar Fornecedores</h2>
          <button class="modal-close" onclick="closeModal('supplier-modal')">
            ×
          </button>
        </div>
        <div id="suppliers-list" class="suppliers-list">
          <!-- Dynamic content -->
        </div>
        <form id="supplier-form">
          <h4>Adicionar Fornecedor</h4>
          <div class="form-grid">
            <div class="input-group">
              <label for="supplier-name">Nome</label>
              <input type="text" id="supplier-name" required />
            </div>
            <div class="input-group">
              <label for="supplier-delivery">Tempo de Entrega (dias)</label>
              <input type="number" id="supplier-delivery" min="1" required />
            </div>
            <div class="input-group">
              <label for="supplier-price">Preço/mg (R$)</label>
              <input type="number" id="supplier-price" step="0.01" min="0" />
            </div>
            <div class="input-group">
              <label for="supplier-contact">Contato</label>
              <input
                type="text"
                id="supplier-contact"
                placeholder="Telefone ou email"
              />
            </div>
          </div>
          <div class="modal-actions">
            <button type="submit" class="btn btn-primary">Adicionar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Raw Editor Modal -->
    <div id="raw-editor-modal" class="modal">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <div class="modal-title-group">
            <h2>Raw Editor</h2>
            <span class="modal-subtitle">Visão rápida de todos os pacientes</span>
          </div>
          <button class="modal-close" onclick="closeModal('raw-editor-modal')">
            ×
          </button>
        </div>
        <div class="raw-editor-toolbar">
          <div class="raw-stats">
            <span id="raw-total-patients">0 pacientes</span>
            <span class="separator">•</span>
            <span id="raw-active-patients">0 ativos</span>
            <span class="separator">•</span>
            <span id="raw-total-consumption">0 mg/semana</span>
          </div>
          <div class="raw-actions">
            <button class="btn btn-ghost btn-small" onclick="copyRawData()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
              </svg>
              Copiar
            </button>
            <button class="btn btn-ghost btn-small" onclick="exportRawCSV()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Exportar CSV
            </button>
          </div>
        </div>
        <div class="raw-editor-container">
          <div class="raw-editor-header">
            <span class="raw-col" style="width: 25%">PACIENTE</span>
            <span class="raw-col" style="width: 10%">DOSE</span>
            <span class="raw-col" style="width: 10%">INTERVALO</span>
            <span class="raw-col" style="width: 15%">PRÓXIMA</span>
            <span class="raw-col" style="width: 12%">ATRASO</span>
            <span class="raw-col" style="width: 10%">STATUS</span>
            <span class="raw-col" style="width: 18%">CONTATO</span>
          </div>
          <div class="raw-editor-content" id="raw-editor-content">
            <!-- Dynamic raw content -->
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Modal -->
    <div id="admin-modal" class="modal">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <div class="modal-title-group">
            <h2>⚙️ Administração</h2>
            <span class="modal-subtitle">Gerenciar usuários e permissões</span>
          </div>
          <button class="modal-close" onclick="closeModal('admin-modal')">
            ×
          </button>
        </div>
        
        <!-- Admin Tabs -->
        <div class="admin-tabs">
          <button class="admin-tab active" onclick="switchAdminTab('users')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            Usuários
          </button>
          <button class="admin-tab" onclick="switchAdminTab('permissions')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect width="18" height="11" x="3" y="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
            Permissões
          </button>
          <button class="admin-tab" onclick="switchAdminTab('settings')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            Configurações
          </button>
        </div>
        
        <!-- Users Tab -->
        <div id="admin-tab-users" class="admin-tab-content active">
          <div class="admin-section">
            <div class="admin-section-header">
              <h3>Usuários do Sistema</h3>
              <button class="btn btn-primary btn-small" onclick="showAddUserForm()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <line x1="19" y1="8" x2="19" y2="14"/>
                  <line x1="22" y1="11" x2="16" y2="11"/>
                </svg>
                Adicionar Usuário
              </button>
            </div>
            
            <!-- Add User Form (hidden by default) -->
            <div id="add-user-form" class="add-user-form hidden">
              <form id="user-form" onsubmit="handleUserSubmit(event)">
                <div class="form-grid">
                  <div class="input-group">
                    <label for="user-name">Nome Completo</label>
                    <input type="text" id="user-name" required placeholder="Ex: Maria Silva"/>
                  </div>
                  <div class="input-group">
                    <label for="user-email-input">Email</label>
                    <input type="email" id="user-email-input" required placeholder="maria@clinica.com"/>
                  </div>
                  <div class="input-group">
                    <label for="user-role">Função</label>
                    <select id="user-role" required onchange="updatePermissionPreview()">
                      <option value="">Selecione...</option>
                      <option value="admin">Administrador</option>
                      <option value="gestora">Gestora</option>
                      <option value="enfermeira">Enfermeira</option>
                      <option value="tecnica">Técnica</option>
                    </select>
                  </div>
                  <div class="input-group">
                    <label for="user-password">Senha Inicial</label>
                    <input type="password" id="user-password" required placeholder="Mínimo 6 caracteres" minlength="6"/>
                  </div>
                </div>
                
                <!-- Permission Preview -->
                <div id="permission-preview" class="permission-preview hidden">
                  <h4>Permissões desta função:</h4>
                  <div id="permission-list" class="permission-list"></div>
                </div>
                
                <div class="form-actions">
                  <button type="button" class="btn btn-ghost" onclick="hideAddUserForm()">Cancelar</button>
                  <button type="submit" class="btn btn-primary">Criar Usuário</button>
                </div>
              </form>
            </div>
            
            <!-- Users List -->
            <div class="users-list" id="users-list">
              <!-- Dynamic user cards -->
            </div>
          </div>
        </div>
        
        <!-- Permissions Tab -->
        <div id="admin-tab-permissions" class="admin-tab-content">
          <div class="admin-section">
            <h3>Matriz de Permissões</h3>
            <p class="section-description">Visualize o que cada função pode fazer no sistema.</p>
            
            <div class="permissions-matrix">
              <table class="permissions-table">
                <thead>
                  <tr>
                    <th>Permissão</th>
                    <th><span class="role-badge admin">Admin</span></th>
                    <th><span class="role-badge gestora">Gestora</span></th>
                    <th><span class="role-badge enfermeira">Enfermeira</span></th>
                    <th><span class="role-badge tecnica">Técnica</span></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Ver Dashboard</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                  </tr>
                  <tr>
                    <td>Registrar Aplicação</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-no">✗</td>
                  </tr>
                  <tr>
                    <td>Adicionar Paciente</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-no">✗</td>
                  </tr>
                  <tr>
                    <td>Editar Paciente</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-no">✗</td>
                    <td class="perm-no">✗</td>
                  </tr>
                  <tr>
                    <td>Entrada de Estoque</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-no">✗</td>
                    <td class="perm-no">✗</td>
                  </tr>
                  <tr>
                    <td>Importar CSV</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-no">✗</td>
                    <td class="perm-no">✗</td>
                  </tr>
                  <tr>
                    <td>Gerenciar Fornecedores</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-no">✗</td>
                    <td class="perm-no">✗</td>
                  </tr>
                  <tr>
                    <td>Exportar Dados</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-no">✗</td>
                    <td class="perm-no">✗</td>
                  </tr>
                  <tr>
                    <td><strong>Gerenciar Usuários</strong></td>
                    <td class="perm-yes">✓</td>
                    <td class="perm-no">✗</td>
                    <td class="perm-no">✗</td>
                    <td class="perm-no">✗</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="admin-tab-settings" class="admin-tab-content">
          <div class="admin-section">
            <h3>Configurações do Sistema</h3>
            
            <div class="settings-grid">
              <div class="settings-card">
                <h4>Níveis de Estoque</h4>
                <div class="input-group">
                  <label>Estoque Máximo (mg)</label>
                  <input type="number" id="settings-max-stock" value="500" min="0"/>
                </div>
                <div class="input-group">
                  <label>Nível de Alerta (mg)</label>
                  <input type="number" id="settings-warning-level" value="100" min="0"/>
                </div>
                <div class="input-group">
                  <label>Nível Crítico (mg)</label>
                  <input type="number" id="settings-critical-level" value="50" min="0"/>
                </div>
                <button class="btn btn-primary btn-full" onclick="saveStockSettings()">Salvar Níveis</button>
              </div>
              
              <div class="settings-card">
                <h4>Dados</h4>
                <button class="btn btn-outline btn-full" onclick="exportAllData()">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                  </svg>
                  Exportar Todos os Dados
                </button>
                <button class="btn btn-danger btn-full" onclick="confirmResetData()">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 6h18"/>
                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                  </svg>
                  Resetar Sistema
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
      <div class="toast-content">
        <span id="toast-message"></span>
      </div>
    </div>

    <script src="firebase-config.js"></script>
    <script src="app.js"></script>
  </body>
</html>
